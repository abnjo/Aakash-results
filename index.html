<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Result Redirector</title>
  <!-- Material Design Fonts & Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <style>
    /* Animated moving gradient background */
    @keyframes gradientAnimation {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
  
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #0d0d0d, #1a1a1a, #333333);
      background-size: 400% 400%;
      animation: gradientAnimation 15s ease infinite;
      color: #e0e0e0;
    }
    
    /* Glassmorphism container */
    .container {
      background: rgba(20, 20, 20, 0.75);
      padding: 2rem;
      border-radius: 20px;
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
      max-width: 500px;
      width: 90%;
      position: relative;
      border: 1px solid rgba(0, 176, 240, 0.5);
    }

    .input-group {
      margin-bottom: 1.5rem;
    }
    
    .input-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: #00B0F0;
    }
    
    .input-group input[type="text"] {
      width: 100%;
      padding: 0.8rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      background: rgba(255, 255, 255, 0.1);
      color: #e0e0e0;
      outline: none;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
      transition: background 0.3s, box-shadow 0.3s;
    }
    
    .input-group input[type="text"]:focus {
      background: rgba(255, 255, 255, 0.15);
      box-shadow: inset 0 0 8px rgba(0, 176, 240, 0.8);
    }
    
    /* Inline checkboxes */
    .checkbox-inline {
      display: inline-flex;
      align-items: center;
      margin-top: 0.5rem;
    }
    .checkbox-inline input[type="checkbox"] {
      margin-right: 0.3rem;
      accent-color: #00B0F0;
    }
    
    /* Glassmorphism button */
    .btn {
      background: rgba(0, 176, 240, 0.5);
      color: #ffffff;
      border: none;
      padding: 0.8rem 1.6rem;
      font-size: 1rem;
      cursor: pointer;
      border-radius: 8px;
      width: 100%;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
      transition: background 0.3s, transform 0.2s;
    }
    
    .btn:hover {
      background: rgba(0, 176, 240, 0.7);
      transform: translateY(-2px);
    }
    
    .results-list {
      margin-top: 1.5rem;
      word-break: break-all;
    }
    
    .results-list a {
      display: block;
      margin-bottom: 0.5rem;
      color: #00B0F0;
      text-decoration: none;
      font-weight: 500;
    }
    
    /* Remove dark mode toggle (default dark mode) */
    /* Optional: if you want any additional custom styling using images in the palette,
       you can set a background-image or use extra colors here. */
  </style>
</head>
<body>
  <div class="container">
    <!-- First input: Roll No -->
    <div class="input-group">
      <label for="psid">Roll No</label>
      <input type="text" id="psid" placeholder="Enter Roll No or list (comma-separated)" />
      <div class="checkbox-inline">
        <input type="checkbox" id="listPsidsCheckbox" />
        <label for="listPsidsCheckbox">list: roll nos</label>
      </div>
    </div>
  
    <!-- Second input: Link -->
    <div class="input-group">
      <label for="link">Link</label>
      <input type="text" id="link" placeholder="Enter URL e.g. http://aakashleap.com:3131/API/ResultRpt?rid=MSwxMDUyNTM0LDE0MTIzMTEyMTQ0MA%3D%3D" />
      <div class="checkbox-inline">
        <input type="checkbox" id="listLinksCheckbox" />
        <label for="listLinksCheckbox">list: links</label>
      </div>
    </div>
  
    <button class="btn" id="resultsBtn">Results</button>
    <div class="results-list" id="resultsList"></div>
  </div>
  
  <script>
    // Function to generate new links based on inputs
    function generateLinks() {
      const rollInput = document.getElementById('psid').value;
      const linkInput = document.getElementById('link').value;
      const listRollNos = document.getElementById('listPsidsCheckbox').checked;
      const listLinks = document.getElementById('listLinksCheckbox').checked;
      
      // Split input values based on list flag
      const rollNos = listRollNos ? rollInput.split(',').map(x => x.trim()).filter(x => x) : [rollInput.trim()];
      const links = listLinks ? linkInput.split(',').map(x => x.trim()).filter(x => x) : [linkInput.trim()];
      
      const generatedLinks = [];
      
      // Process each link provided
      links.forEach(link => {
        try {
          const urlObj = new URL(link);
          // Extract and decode the "rid" parameter from the URL
          let ridParam = urlObj.searchParams.get('rid') || "";
          ridParam = decodeURIComponent(ridParam);
          // Remove trailing "==" if present
          if (ridParam.endsWith("==")) {
            ridParam = ridParam.slice(0, -2);
          }
          
          // Decode Base64 string to retrieve raw content (format expected: "1,testid,rollno")
          let decoded;
          try {
            decoded = atob(ridParam);
          } catch (error) {
            alert('Error decoding Base64 string. Check the input link.');
            return;
          }
          
          const parts = decoded.split(',');
          if (parts.length !== 3) {
            alert('Decoded string not in expected format (1,testid,rollno).');
            return;
          }
          const [part1, testId] = parts;
          
          // For each roll no provided, update the string, re-encode, and form a new link.
          rollNos.forEach(newRoll => {
            const newRaw = `${part1},${testId},${newRoll}`;
            const newEncoded = btoa(newRaw);
            const finalRid = encodeURIComponent(newEncoded + "==");
            urlObj.searchParams.set('rid', finalRid);
            generatedLinks.push(urlObj.toString());
          });
        } catch (e) {
          alert("Invalid URL: " + link);
        }
      });
      
      return generatedLinks;
    }
    
    document.getElementById('resultsBtn').addEventListener('click', () => {
      const links = generateLinks();
      const resultsListDiv = document.getElementById('resultsList');
      resultsListDiv.innerHTML = "";
      
      if (links.length === 0) {
        resultsListDiv.innerHTML = "<p>No valid links generated.</p>";
        return;
      }
      
      if (links.length === 1) {
        window.location.href = links[0];
      } else {
        const info = document.createElement('p');
        info.textContent = "Multiple links generated:";
        resultsListDiv.appendChild(info);
        
        links.forEach(link => {
          const a = document.createElement('a');
          a.href = link;
          a.target = "_blank";
          a.textContent = link;
          resultsListDiv.appendChild(a);
        });
      }
    });
  </script>
</body>
</html>
